<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MCP Vibe Inspector Sidebar</title>
    <style>
      :root {
        --padding: 12px;
        --gap: 12px;
      }
      html,
      body {
        margin: 0;
        padding: 0;
        background: transparent;
        color: var(--vscode-editor-foreground);
        font-family: var(--vscode-font-family);
      }
      .container {
        padding: var(--padding);
        box-sizing: border-box;
      }
      .section {
        margin-bottom: var(--gap);
      }
      .title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        font-size: 13px;
      }
      .primary {
        width: 100%;
        padding: 8px 10px;
        border-radius: 6px;
        border: none;
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        cursor: pointer;
        font-weight: 700;
      }
      .muted {
        color: var(--vscode-descriptionForeground);
        font-size: 12px;
      }
      .code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono',
          'Segoe UI Mono', monospace;
        font-size: 12px;
        color: var(--vscode-textLink-foreground);
        background: transparent;
      }
      input.url-input {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid var(--vscode-input-border);
        background: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
        box-sizing: border-box;
      }
      .row {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .small {
        font-size: 12px;
      }
      .example {
        margin-top: 6px;
      }
      .copy-btn {
        background: transparent;
        border: none;
        color: var(--vscode-textLink-foreground);
        cursor: pointer;
        padding: 4px;
      }
      .divider {
        height: 1px;
        background: var(--vscode-panel-border);
        margin: 10px 0;
      }
      .foot {
        font-size: 11px;
        color: var(--vscode-descriptionForeground);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="section">
        <div class="title">
          <span class="icon">ðŸš€</span><span>MCP Vibe Inspector</span>
        </div>
        <div class="muted small" style="margin-top: 8px">
          Start the local Inspector and open it here.
        </div>
      </div>

      <div class="section">
        <button id="startInspectorBtn" class="primary">Start Inspector</button>
        <div class="row" style="margin-top: 8px; align-items: center">
          <div class="muted small">If the button fails, run</div>
          <div style="flex: 1" class="row">
            <code id="fallbackCmd" class="code" data-no-auto-copy>
              npx @modelcontextprotocol/inspector
            </code>
            <button
              id="copyFallback"
              class="copy-btn"
              title="Copy command"
              aria-label="Copy fallback command"
            >
              <svg
                width="12"
                height="12"
                viewBox="0 0 16 16"
                fill="none"
                aria-hidden="true"
              >
                <path
                  d="M4 2h7a1 1 0 0 1 1 1v1"
                  stroke="currentColor"
                  stroke-width="1.25"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <rect
                  x="3"
                  y="5"
                  width="9"
                  height="9"
                  rx="1"
                  stroke="currentColor"
                  stroke-width="1.25"
                />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="title">
          <span class="icon">ðŸ”—</span><span>Inspector URL</span>
        </div>
        <div style="margin-top: 8px">
          <input
            id="inspectorUrl"
            class="url-input"
            placeholder="Paste Inspector URL here (with token)"
          />
          <div class="example small muted">
            Example:
            <span class="code"
              >http://localhost:6274/?MCP_PROXY_AUTH_TOKEN=xyz</span
            >
          </div>
          <button id="openBtn" class="primary" style="margin-top: 8px">
            Open Inspector
          </button>
        </div>
      </div>

      <div class="divider"></div>

      <div class="section foot">
        <div style="font-weight: 600">MCP Server (optional)</div>
        <div style="margin-top: 8px" class="muted small">
          Provide your MCP server transport and URL to connect from the
          Inspector. Follow the steps below inside the Inspector panel:
        </div>

        <ol
          style="
            margin-top: 8px;
            padding-left: 18px;
            font-size: 13px;
            line-height: 1.45;
          "
        >
          <li>
            <strong>Select transport</strong> â€” choose one in the Inspector
            panel:
            <ul style="margin: 6px 0 0 18px">
              <li><code class="code">stdio</code></li>
              <li><code class="code">streamable-http</code></li>
              <li><code class="code">sse</code></li>
            </ul>
          </li>
          <li style="margin-top: 8px">
            <strong>Provide URL</strong> â€” paste your MCP server URL inside the
            Inspector (example shown):
            <div class="example" style="margin-top: 6px">
              <code class="code">https://abcstark-server.fastmcp.app/mcp</code>
            </div>
          </li>
          <li style="margin-top: 8px">
            <strong>Click Connect</strong> â€” the Inspector will use the chosen
            transport and URL to connect.
          </li>
        </ol>
      </div>
    </div>

    <script>
      const vscode = acquireVsCodeApi();
      const startBtn = document.getElementById('startInspectorBtn');
      const copyFallback = document.getElementById('copyFallback');
      const fallbackCmd = document
        .getElementById('fallbackCmd')
        .textContent.trim();
      const openBtn = document.getElementById('openBtn');
      const urlInput = document.getElementById('inspectorUrl');

      // transient in-view status message (accessible)
      function showTransient(text, type = 'info') {
        let el = document.getElementById('mcp-msg');
        if (!el) {
          el = document.createElement('div');
          el.id = 'mcp-msg';
          el.setAttribute('role', 'status');
          el.setAttribute('aria-live', 'polite');
          el.style.position = 'fixed';
          el.style.right = '12px';
          el.style.bottom = '12px';
          el.style.padding = '8px 10px';
          el.style.borderRadius = '6px';
          el.style.boxShadow = '0 6px 18px rgba(0,0,0,0.4)';
          el.style.zIndex = '9999';
          el.style.transition = 'opacity 0.25s ease';
          document.body.appendChild(el);
        }
        el.textContent = text;
        el.style.background =
          type === 'error'
            ? 'var(--vscode-inputValidation-errorBackground)'
            : 'var(--vscode-input-background)';
        el.style.color = 'var(--vscode-foreground)';
        el.style.opacity = '1';
        if (window._mcpMsgTimer) clearTimeout(window._mcpMsgTimer);
        window._mcpMsgTimer = setTimeout(() => {
          el.style.opacity = '0';
        }, 2000);
      }

      startBtn?.setAttribute('aria-label', 'Start Inspector');
      startBtn?.addEventListener('click', () => {
        vscode.postMessage({ command: 'startInspector' });
        showTransient('Starting Inspector...');
      });

      copyFallback?.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(fallbackCmd);
          showTransient('Command copied');
        } catch (e) {
          showTransient('Copy failed', 'error');
        }
      });

      openBtn?.addEventListener('click', () => {
        const url = urlInput.value.trim();
        try {
          const parsed = new URL(url);
          if (!/^https?:$/.test(parsed.protocol))
            throw new Error('Invalid protocol');
          if (!parsed.searchParams.has('MCP_PROXY_AUTH_TOKEN'))
            throw new Error('Missing token param');
        } catch (e) {
          showTransient(
            'Enter a valid Inspector URL (with MCP_PROXY_AUTH_TOKEN)',
            'error'
          );
          return;
        }
        vscode.postMessage({ command: 'openInspector', url });
        showTransient('Opening Inspector...');
      });

      // make code snippets copyable via small copy buttons
      (function attachSnippetCopy() {
        const copySvg =
          '<svg width="12" height="12" viewBox="0 0 16 16" fill="none" aria-hidden="true"><path d="M4 2h7a1 1 0 0 1 1 1v1" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><rect x="3" y="5" width="9" height="9" rx="1" stroke="currentColor" stroke-width="1.25"/></svg>';
        const codes = document.querySelectorAll('.code');
        codes.forEach((c) => {
          // skip explicit no-auto-copy snippets (fallback) or if a copy button already exists nearby
          if (c.hasAttribute('data-no-auto-copy')) return;
          if (c.id === 'fallbackCmd') return;
          if (
            c.nextElementSibling &&
            c.nextElementSibling.classList &&
            c.nextElementSibling.classList.contains('copy-btn')
          )
            return;
          if (
            c.parentNode &&
            c.parentNode.querySelector &&
            c.parentNode.querySelector('.copy-btn')
          )
            return;
          const btn = document.createElement('button');
          btn.className = 'copy-btn';
          btn.setAttribute('aria-label', 'Copy snippet');
          btn.title = 'Copy';
          btn.innerHTML = copySvg;
          btn.addEventListener('click', async () => {
            try {
              await navigator.clipboard.writeText((c.textContent || '').trim());
              showTransient('Copied');
            } catch (e) {
              showTransient('Copy failed', 'error');
            }
          });
          c.parentNode.insertBefore(btn, c.nextSibling);
        });
      })();

      // listen for messages from extension (optional)
      window.addEventListener('message', (ev) => {
        const msg = ev.data;
        if (msg?.command === 'setInspectorUrl' && msg.url) {
          urlInput.value = msg.url;
          showTransient('Inspector URL filled');
        }
      });
    </script>
  </body>
</html>
